import glob from 'glob';
import { config } from 'mr-config';
import { requireRootPackage, subPackageJsonPaths } from 'mr-scrape';
import { actions, init, reducer } from 'mr-state';
import { RootPackageJson } from 'mr-types';
import _ from 'ramda';
import { applyMiddleware, createStore } from 'redux';
import thunk from 'redux-thunk';

// tslint:disable-next-line
const log = (msg: any) => console.log(JSON.stringify(msg, null, 2));

const store = createStore(reducer, init, applyMiddleware(thunk));

const rootPackagePath = `${config.root}/package.json`;
store.dispatch(actions.setRoot(rootPackagePath));

const rootPackageJson: RootPackageJson =
  requireRootPackage(rootPackagePath);

log(rootPackageJson);

const subs = subPackageJsonPaths(rootPackageJson);
log(subs);
store.dispatch(actions.setSubs(subs));

log(store.getState());
